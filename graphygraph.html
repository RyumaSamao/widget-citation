<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Donut NEVER CROP</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

<style>
:root{
  --bg:#1B1B1B;
  --panel:#292929;
  --text:#eaeaea;
  --muted:rgba(255,255,255,0.08);
  --scale:1;
}

html, body{
  margin:0; padding:0;
  width:100%; height:100%;
  background:var(--bg);
  font-family:Inter, sans-serif;
  overflow:hidden;
}

/* —————  ANTI‑CROP SYSTEM  ————— */
.wrapper{
  width:100%;
  height:auto;
  overflow:hidden;
  display:flex;
  justify-content:center;
}

.scaler{
  transform:scale(var(--scale));
  transform-origin:top left;
  width:350px;   /* taille ORIGINE */
  height:auto;
}

.card{
  background:var(--panel);
  border-radius:1em;
  padding:1em;
  width:350px;
  box-sizing:border-box;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:1em;
}

.chart-area{
  width:180px;
  height:180px;
  position:relative;
}

.donut-shell{
  width:100%; height:100%; position:relative;
}

canvas{
  width:100% !important;
  height:100% !important;
  display:block;
}

.center-number{
  position:absolute;
  left:50%; top:50%;
  transform:translate(-50%, -50%);
  font-size:1.3em;
  font-weight:700;
  color:var(--text);
}

.legend{
  display:flex;
  flex-direction:column;
  gap:0.4em;
  width:100%;
}

.item{
  display:flex;
  justify-content:space-between;
  align-items:center;
  background:var(--muted);
  padding:0.3em 0.6em;
  border-radius:0.5em;
  font-size:0.8em;
  color:var(--text);
}

.badge{
  width:0.7em; height:0.7em; border-radius:50%; flex-shrink:0;
}
</style>
</head>

<body>
<div class="wrapper">
  <div class="scaler" id="scaler">
    <div class="card">
      <div class="chart-area">
        <div class="donut-shell" id="donutShell">
          <canvas id="donutCanvas"></canvas>
          <div class="center-number" id="centerNumber">0</div>
        </div>
      </div>
      <div class="legend" id="legendArea"></div>
    </div>
  </div>
</div>

<script>
const BASE_WIDTH = 350; // largeur originale qui sert de référence

function rescale(){
  const w = document.body.clientWidth;
  let scale = w / BASE_WIDTH;
  if(scale > 1) scale = 1; // jamais plus grand
  document.documentElement.style.setProperty("--scale", scale);
}
window.addEventListener("resize", rescale);
rescale();

/* Donut */
const DEFAULT={
  labels:["Not Started","In Progress","Paused","Completed"],
  values:[76,19,10,7],
  colors:["#F5B333","#F06292","#8C8CFF","#2FC7FF"]
};

function lightenColor(color, percent){
  const f=color.slice(1), R=parseInt(f.slice(0,2),16), G=parseInt(f.slice(2,4),16), B=parseInt(f.slice(4,6),16);
  return "#" + (0x1000000 + (Math.round(R+(255-R)*percent)<<16) + (Math.round(G+(255-G)*percent)<<8) + Math.round(B+(255-B)*percent)).toString(16).slice(1);
}

const hoverColors=DEFAULT.colors.map(c=>lightenColor(c,0.3));
const ctx=document.getElementById("donutCanvas").getContext("2d");

let chart=new Chart(ctx,{
  type:"doughnut",
  data:{ labels:DEFAULT.labels, datasets:[{
    data:DEFAULT.values,
    backgroundColor:DEFAULT.colors,
    hoverBackgroundColor:hoverColors,
    hoverOffset:12, spacing:4,
    borderColor:"#292929", borderWidth:2, borderRadius:8
  }]},
  options:{ responsive:true, maintainAspectRatio:false, cutout:"60%", plugins:{legend:{display:false}} }
});

function buildLegend(){
  const leg=document.getElementById("legendArea"); leg.innerHTML="";
  const order=[2,1,0,3];
  order.forEach(i=>{
    const item=document.createElement("div"); item.className="item";
    item.innerHTML=`<div style="display:flex;align-items:center;gap:0.3em;"><div class="badge" style="background:${DEFAULT.colors[i]}"></div>${DEFAULT.labels[i]}</div><div>${DEFAULT.values[i]}</div>`;
    leg.appendChild(item);
  });
}
buildLegend();
document.getElementById("centerNumber").textContent=DEFAULT.values.reduce((a,b)=>a+b,0);
</script>
</body>
</html>
