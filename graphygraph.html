<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Donut Responsive Petit</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

<style>
:root{
  --bg:#1B1B1B;
  --panel:#292929;
  --text:#eaeaea;
  --muted:rgba(255,255,255,0.08);
}

html, body{
  margin:0; padding:0;
  width:100%; height:100%;
  background:var(--bg);
  font-family:Inter, sans-serif;
}

body{
  display:flex;
  justify-content:center;
  align-items:center;
  overflow:hidden;
  padding:1em;
}

.card{
  display:flex;
  flex-direction:row;
  background:var(--panel);
  border-radius:1em;
  padding:1em;
  gap:1em;
  justify-content:center;
  align-items:center;
  width:100%;
  max-width:400px;       /* max largeur du container réduit */
  height:auto;
  box-sizing:border-box;
}

.chart-area{
  position: relative;
  width:100%;
  max-width:150px;   /* taille max réduite */
  aspect-ratio:1/1;   /* carré pour pas déformer */
}

.donut-shell{
  width:100%;
  height:100%;
  position:relative;
  transition: transform 0.5s ease-in-out;
}

canvas{
  width:100% !important;
  height:100% !important;
  display:block;
}

.center-number{
  position:absolute;
  left:50%; top:50%;
  transform:translate(-50%, -50%);
  color:var(--text);
  font-size:1.2em;
  font-weight:700;
  pointer-events:none;
}

.legend{
  flex:0 0 auto;
  display:flex;
  flex-direction:column;
  gap:0.5em;
  justify-content:center;
  min-width:100px;
}

.item{
  display:flex;
  align-items:center;
  gap:0.5em;
  background:var(--muted);
  padding:0.4em 0.8em;
  border-radius:999px;
  color:var(--text);
  font-size:0.9em;
  justify-content:space-between;
  transition:background 0.2s;
}

.item:hover{ background:rgba(255,255,255,0.12); }
.badge{ width:0.8em; height:0.8em; border-radius:50%; flex-shrink:0; }
</style>
</head>

<body>
<div class="card">
  <div class="chart-area">
    <div class="donut-shell" id="donutShell">
      <canvas id="donutCanvas"></canvas>
      <div class="center-number" id="centerNumber">0</div>
    </div>
  </div>
  <div class="legend" id="legendArea"></div>
</div>

<script>
const DEFAULT={
  labels:["Not Started","In Progress","Paused","Completed"],
  values:[76,19,10,7],
  colors:["#F5B333","#F06292","#8C8CFF","#2FC7FF"]
};

function lightenColor(color, percent){
  const f=color.slice(1),
        R=parseInt(f.slice(0,2),16),
        G=parseInt(f.slice(2,4),16),
        B=parseInt(f.slice(4,6),16);
  return "#" + (0x1000000 + (Math.round(R+(255-R)*percent)<<16) + (Math.round(G+(255-G)*percent)<<8) + Math.round(B+(255-B)*percent)).toString(16).slice(1);
}

const hoverColors=DEFAULT.colors.map(c=>lightenColor(c,0.3));
const ctx=document.getElementById("donutCanvas").getContext("2d");

let chart=new Chart(ctx,{
  type:"doughnut",
  data:{
    labels:DEFAULT.labels,
    datasets:[{
      data:DEFAULT.values,
      backgroundColor:DEFAULT.colors,
      hoverBackgroundColor:hoverColors,
      hoverOffset:12,
      spacing:4,
      borderColor:"#292929",
      borderWidth:2,
      borderRadius:8
    }]
  },
  options:{
    responsive:true,
    maintainAspectRatio:true,
    cutout:"60%",
    plugins:{ legend:{display:false}, tooltip:{enabled:true} },
    onHover:(evt,els)=>{
      document.getElementById("donutShell").style.transform=els.length?"scale(1.05)":"scale(1)";
    }
  }
});

function buildLegend(){
  const leg=document.getElementById("legendArea");
  leg.innerHTML="";
  const order=[2,1,0,3];
  order.forEach(i=>{
    const item=document.createElement("div");
    item.className="item";
    item.innerHTML=`
      <div style="display:flex;align-items:center;gap:0.3em;">
        <div class="badge" style="background:${DEFAULT.colors[i]}"></div>
        <div>${DEFAULT.labels[i]}</div>
      </div>
      <div>${DEFAULT.values[i]}</div>
    `;
    leg.appendChild(item);
  });
}
buildLegend();

function updateDonut(newValues){
  chart.data.datasets[0].data=newValues;
  chart.update();
  document.getElementById("centerNumber").textContent=newValues.reduce((a,b)=>a+b,0);
  buildLegend();
}

document.getElementById("centerNumber").textContent=DEFAULT.values.reduce((a,b)=>a+b,0);
window.updateDonut=updateDonut;
</script>
</body>
</html>
